function dependOn(){"use strict";return[require("util"),require("common"),require("analytics"),require("proxy")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),function(r,s,a,e){"use strict";var t,d,i=null,l={};for(t in i||(i=new function(){var n={},o={};this.proxy=e.proxy.bind(this),this.LOG=s.LOG,this.registerHandlers=function(e){r.extend(n,e)},this.registerModule=function(e,t){l[e]=t},this.getModule=function(e){return l[e]},this.reset=function(e,t){s.reset(e.environment),a.setAnalyticsUsage(e.analytics_on,t.tab.id),e.environment&&(a.environment=e.environment,a.event(a.e.OPTIONS_SET_ENV))},this.registerHandlers({reset:this.proxy(this.reset)}),this.version=-1,this.legacyShim=function(){return this.version<=1},this.setVersion=function(e){this.version=e},this.resetPersistPrefCount=function(){r.setCookie("persist-menu-closed",0,3650)},this.incrementPersistPrefCount=function(){var e=r.getCookie("persist-menu-closed");e<4&&"false"!==r.getCookie("always-show-pdf-menu")&&(e++,r.setCookie("persist-menu-closed",e,3650)),4<=e&&(r.setCookie("always-show-pdf-menu","false",3650),a.event(a.e.PERSIST_PDF_OPENPDF_PREF_OFF))},this.isEnablePersistMenu=function(){return"false"!==r.getCookie("always-show-pdf-menu")&&(r.getCookie("persist-menu-closed")<4?!(SETTINGS.IS_READER||SETTINGS.IS_ERP_READER||this.legacyShim()):"true"===r.getCookie("always-show-pdf-menu")&&(this.resetPersistPrefCount(),!0))},this.handler=function(e,t,s){var i;if(e&&(this.dump(e,"Communicate Handler receive: "),t&&t.tab&&(e.tabId=t.tab.id,d=d||t.tab.id,e.main_op))){if("relay_to_content"===e.main_op)return 1==e.newUI&&"dismiss"===e.content_op?(e.persist=!1,null!=e.tabId&&(o[e.tabId].persist=!1),a.logBrowserAnalytics(e),this.incrementPersistPrefCount()):1==e.newUI&&"pdf_menu"===e.panel_op&&(this.isEnablePersistMenu()?null!=e.tabId&&(o[e.tabId].persist=!0):e.persist=!1,a.logBrowserAnalytics(e),this.resetPersistPrefCount()),delete e.main_op,void this.sendMessage(e);if(a.logBrowserAnalytics(e),i=e.main_op,delete e.main_op,"dismiss"===i&&this.closeDialog(),n[i])return a.setOp({preview:"Copy",image_preview:"Image",send:"Send",fillsign:"FillSign",export:"Export",acom:"GotoAcom",to_pdf:"ConvertToPdf"}[e.handleResult]),n[i](e,t,s);r.consoleLog("failed to find handler for: "+i)}},this.closeDialog=function(){r.isFF()&&this.globals.panel.hide()},this.echoRequest=function(e){var t,s,i;if(SETTINGS.CHROME_VERSION<SETTINGS.SUPPORTED_VERSION)this.getModule("session").newSession("data/js/options.html",!0,{});else{if(!this.avoidUrl(e.url)){if(r.isFF())t=this.lastRequest||{panel_op:"html_menu"};else{var n=e.id||e.tabId;if(o[n]){if("cancelled"!==(t=o[n]).current_status&&"pdf_opened"!==t.current_status||(i=t.is_pdf,this.clearStatus(t),t.is_pdf=i),t.current_status&&(t.panel_op="status"),this,"mac"===SETTINGS.OS)return void this.getModule("session").newSession("data/js/options.html?os=mac",!0,{});s=t.is_pdf?"pdf_menu":"html_menu",t.panel_op=t.panel_op||s,"html_menu"==s&&(t.persist=!1),r.consoleLog("repeat cached request: "+t.panel_op)}}return t}this.disable(e.id)}},this.echo=function(e){a.event(a.e.TREFOIL_CLICKED);var t=this.echoRequest(e);t&&(t.trefoilClick=!0,this.sendMessage(t))},this.setGlobals=function(e){this.globals=e},this.dump=function(e,t){var s,i=[t];for(s in e)e.hasOwnProperty(s)&&i.push("  "+s+": "+e[s]);r.consoleLog(i.join("\n"))},this.sendMessage=function(e){var t,s=e.tabId;this.dump(e,"Sending message:"),e.version=this.version,o[s]=r.extend(o[s],e),"pdf_menu"===e.panel_op&&(e.trefoilClick?t=a.e.TREFOIL_PDF_FROM_CLICK:0==e.persist&&(t=a.e.TREFOIL_PDF_MENU_SHOWN)),"flickr"===e.panel_op&&(t=a.e.FLICKR_OFFER_SHOWN),"html_menu"===e.panel_op&&(t=a.e.TREFOIL_HTML_FROM_CLICK),t&&a.checkAndLogAnalytics(t),r.sendMessage(e,this.globals),delete e.trefoilClick},this.deferMessage=function(e){"undefined"==typeof setTimeout?this.sendMessage(e):setTimeout(this.proxy(this.sendMessage,e),0)},this.filenameFromUrl=function(e){var t=decodeURIComponent(e),s=(t=(t=t.split("?")[0].replace(/\S*\//,"")).replace(/[\?]\S*/,"")).split("/");return-1==(t=s[s.length-1]).toLowerCase().indexOf(".pdf")&&(t+=".pdf"),t},this.pdf_menu=function(e,t){var s;"mac"!==SETTINGS.OS&&((s=o[t.tab.id]=r.extend(o[t.tab.id],{tabId:t.tab.id})).filename=this.filenameFromUrl(e.url),s.panel_op="pdf_menu",s.url=e.url,s.is_pdf=!0,1==e.persist&&this.isEnablePersistMenu()?s.persist=!0:s.persist=!1,"false"!==r.getCookie("always-show-pdf-menu")&&(1==s.persist&&a.event(a.e.PERSIST_PDF_MENU_SHOWN),this.deferMessage(s)))},this.loaded=function(e){o[e]=r.extend(o[e],{tabId:e,loaded:!0}),this.enable(e)},this.clearStatus=function(e,t){"in_progress"!==e.current_status&&"downloading"!==e.current_status&&(!t&&"waiting"===e.current_status||(this.getModule("acro-web2pdf").cancelConversion(e.tabId),delete e.current_status,delete e.file_path,delete e.domtitle,delete e.timing,delete e.panel_op,delete e.is_pdf,delete e.trefoilUI,delete e.newUI))},this.loading=function(e){var t=e.id;o[t]=r.extend(o[t],{tabId:t,loaded:!1}),this.clearStatus(o[t],!0),this.enable(t)},this.active=function(e){if(d=e.tabId,o[d]=r.extend(o[d],{tabId:e.tabId}),this.isEnablePersistMenu()){var t=this.echoRequest(o[d]);t&&t.persist&&this.sendMessage(t)}},this.enable=function(e){var t=o[e].loaded?"data/images/acrobat_dc_appicon_24.png":"data/images/acrobat_dc_appicon_24_translucent.png";chrome.browserAction.setIcon({path:t,tabId:e}),o[e].loaded?chrome.browserAction.enable(e):chrome.browserAction.disable(e)},this.disable=function(e){o[e]&&(o[e].loaded=!1,this.enable(e))},this.close=function(e){this.getModule("acro-web2pdf").cancelConversion(e),delete o[e],d===e&&(d=null)},this.tabReplace=function(e,t){this.close(t),this.loaded(e)},this.activeTab=function(){return d},this.noop=function(){},this.avoidUrl=function(e){return e=e||"",this.version===SETTINGS.ERP_READER_VER||(!!e.startsWith("https://chrome.google.com")||(!e.endsWith(".pdf")&&!e.endsWith(".PDF")&&this.version===SETTINGS.READER_VER||!e.startsWith("http")))}},r.isChrome()&&(chrome.runtime.onMessage.addListener(i.proxy(i.handler)),chrome.tabs.onActivated.addListener(i.proxy(i.active)),chrome.tabs.onRemoved.addListener(i.proxy(i.close)),chrome.tabs.onCreated.addListener(i.proxy(i.loading)),chrome.tabs.onReplaced.addListener(i.proxy(i.tabReplace)))),i)i.hasOwnProperty(t)&&("function"==typeof i[t]?exports[t]=i[t].bind(i):exports[t]=i[t]);return i.registerHandlers({"send-analytics":i.proxy(i.noop)}),i});